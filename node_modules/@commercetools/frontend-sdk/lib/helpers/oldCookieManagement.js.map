{"version":3,"sources":["../../src/helpers/oldCookieManagement.ts","../../src/library/oldCookieHandler.ts","../../src/constants/rememberMeCookieKey.ts"],"sourcesContent":["import { IncomingMessage, ServerResponse } from \"http\";\nimport { ServerOptions } from \"../types/cookieHandling\";\nimport { CookieHandlerSync } from \"../library/oldCookieHandler\";\nimport { REMEMBER_ME_COOKIE_KEY } from \"../constants/rememberMeCookieKey\";\n\n/**\n * @deprecated Use rememberMeCookieAsync instead. An object containing helper methods for interacting with the remember me cookie, is not compatible with optional cookieHandlingOverride passed in SDK.configure.\n */\nexport const rememberMeCookie = {\n\t/**\n\t * @deprecated Use rememberMeCookieAsync.get instead. Gets the remember me cookie, is not compatible with optional cookieHandlingOverride passed in SDK.configure.\n\t *\n\t * @param {ServerOptions} [serverOptions] - An optional {@link ServerOptions} object containing the res and req objects for ServerResponse and IncomingMessage with cookies respectively. Required for server-side rendering session management.\n\t *\n\t * @returns {boolean} A boolean indicating whether or not the user is to be remembered.\n\t */\n\tget: function (serverOptions?: ServerOptions): boolean {\n\t\tif (\n\t\t\tCookieHandlerSync.getCookie(REMEMBER_ME_COOKIE_KEY, serverOptions)\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\t/**\n\t * @deprecated Use rememberMeCookieAsync.get instead. Sets the remember me cookie, is not compatible with optional cookieHandlingOverride passed in SDK.configure.\n\t *\n\t * @param {boolean} rememberMe - The value in which to set the remember me cookie.\n\t * @param {ServerOptions} [serverOptions] - An optional {@link ServerOptions} object containing the res and req objects for ServerResponse and IncomingMessage with cookies respectively. Required for server-side rendering session management.\n\t *\n\t * @returns {void} Void.\n\t */\n\tset: function (rememberMe: boolean, serverOptions?: ServerOptions) {\n\t\tif (rememberMe) {\n\t\t\treturn CookieHandlerSync.setCookie(\n\t\t\t\tREMEMBER_ME_COOKIE_KEY,\n\t\t\t\t\"1\",\n\t\t\t\tserverOptions\n\t\t\t);\n\t\t} else {\n\t\t\tthis.remove();\n\t\t}\n\t},\n\t/**\n\t * @deprecated Use rememberMeCookieAsync.remove instead. Removes the remember me cookie, is not compatible with optional cookieHandlingOverride passed in SDK.configure.\n\t *\n\t * @param {ServerOptions} [serverOptions] - An optional {@link ServerOptions} object containing the res and req objects for ServerResponse and IncomingMessage with cookies respectively. Required for server-side rendering session management.\n\t *\n\t * @returns {void} Void.\n\t */\n\tremove: function (serverOptions?: ServerOptions) {\n\t\treturn CookieHandlerSync.deleteCookie(\n\t\t\tREMEMBER_ME_COOKIE_KEY,\n\t\t\tserverOptions\n\t\t);\n\t},\n};\n\n/**\n * @deprecated An object containing helper methods for interacting with the server session.\n */\nexport const serverSession = {\n\t/**\n\t * @deprecated Pass the {@link IncomingMessage} and {@link ServerResponse} to cookie helpers directly instead. Used to retieve the session string, is not compatible with optional cookieHandlingOverride passed in SDK.configure.\n\t *\n\t * @param {IncomingMessage} req - The incoming message created by the server.\n\t * @param {ServerResponse} res - The server response object created by the server.\n\t */\n\tget: function (\n\t\treq: IncomingMessage,\n\t\tres: ServerResponse\n\t): string | undefined {\n\t\treturn CookieHandlerSync.getCookie(\"frontastic-session\", {\n\t\t\treq,\n\t\t\tres,\n\t\t})?.toString();\n\t},\n};\n","import { serialize, parse } from \"cookie\";\nimport {\n\tServerOptions,\n\tTmpCookiesObj,\n\tCookieValueTypes,\n} from \"../types/cookieHandling\";\n\n// DEPRECATED, DO NOT USE. This class only exists to satisfy backwards compatability for deprecated methods in ../helpers/cookieManagementOld.ts\nexport class CookieHandlerSync {\n\tstatic isClientSide(): boolean {\n\t\treturn typeof window !== \"undefined\";\n\t}\n\n\tstatic stringify(value: string = \"\"): string {\n\t\ttry {\n\t\t\tconst result = JSON.stringify(value);\n\t\t\treturn /^[\\{\\[]/.test(result) ? result : value;\n\t\t} catch (e) {\n\t\t\treturn value;\n\t\t}\n\t}\n\n\tstatic decode(str: string): string {\n\t\treturn str ? str.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent) : str;\n\t}\n\n\tstatic processValue(value: string): CookieValueTypes {\n\t\tswitch (value) {\n\t\t\tcase \"true\":\n\t\t\t\treturn true;\n\t\t\tcase \"false\":\n\t\t\t\treturn false;\n\t\t\tcase \"undefined\":\n\t\t\t\treturn undefined;\n\t\t\tcase \"null\":\n\t\t\t\treturn null;\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t}\n\t}\n\n\tstatic getCookies(options?: ServerOptions): TmpCookiesObj {\n\t\tlet req;\n\t\tif (options) {\n\t\t\treq = options.req;\n\t\t}\n\t\tif (!this.isClientSide()) {\n\t\t\t// if cookie-parser is used in project, get cookies from ctx.req.cookies\n\t\t\t// if cookie-parser isn't used in project, get cookies from ctx.req.headers.cookie\n\t\t\tif (req?.cookies) {\n\t\t\t\treturn req.cookies;\n\t\t\t}\n\t\t\tif (req?.headers?.cookie) {\n\t\t\t\treturn parse(req.headers.cookie);\n\t\t\t}\n\t\t\treturn {};\n\t\t}\n\n\t\tconst _cookies: TmpCookiesObj = {};\n\t\tconst documentCookies = document.cookie\n\t\t\t? document.cookie.split(\"; \")\n\t\t\t: [];\n\n\t\tfor (let i = 0, len = documentCookies.length; i < len; i++) {\n\t\t\tconst cookieParts = documentCookies[i].split(\"=\");\n\n\t\t\tconst _cookie = cookieParts.slice(1).join(\"=\");\n\t\t\tconst name = cookieParts[0];\n\n\t\t\t_cookies[name] = _cookie;\n\t\t}\n\n\t\treturn _cookies;\n\t}\n\n\tstatic hasCookie(key: string, options?: ServerOptions): boolean {\n\t\tif (!key) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cookie = this.getCookies(options);\n\t\treturn cookie.hasOwnProperty(key);\n\t}\n\n\tstatic setCookie(key: string, data: any, options?: ServerOptions): void {\n\t\tlet _cookieOptions: any;\n\t\tlet _req;\n\t\tlet _res;\n\t\tif (options) {\n\t\t\tconst { req, res, ..._options } = options;\n\t\t\t_req = req;\n\t\t\t_res = res;\n\t\t\t_cookieOptions = _options;\n\t\t}\n\n\t\tconst cookieStr = serialize(key, this.stringify(data), {\n\t\t\tpath: \"/\",\n\t\t\t..._cookieOptions,\n\t\t});\n\t\tif (!this.isClientSide()) {\n\t\t\tif (_res && _req) {\n\t\t\t\tlet currentCookies = _res.getHeader(\"Set-Cookie\");\n\n\t\t\t\tif (!Array.isArray(currentCookies)) {\n\t\t\t\t\tcurrentCookies = !currentCookies\n\t\t\t\t\t\t? []\n\t\t\t\t\t\t: [String(currentCookies)];\n\t\t\t\t}\n\t\t\t\t_res.setHeader(\"Set-Cookie\", currentCookies.concat(cookieStr));\n\n\t\t\t\tif (_req && _req.cookies) {\n\t\t\t\t\tconst _cookies = _req.cookies;\n\t\t\t\t\tdata === \"\"\n\t\t\t\t\t\t? delete _cookies[key]\n\t\t\t\t\t\t: (_cookies[key] = this.stringify(data));\n\t\t\t\t}\n\n\t\t\t\tif (_req && _req.headers && _req.headers.cookie) {\n\t\t\t\t\tconst _cookies = parse(_req.headers.cookie);\n\n\t\t\t\t\tdata === \"\"\n\t\t\t\t\t\t? delete _cookies[key]\n\t\t\t\t\t\t: (_cookies[key] = this.stringify(data));\n\n\t\t\t\t\t_req.headers.cookie = Object.entries(_cookies).reduce(\n\t\t\t\t\t\t(accum, item) => {\n\t\t\t\t\t\t\treturn accum.concat(`${item[0]}=${item[1]};`);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdocument.cookie = cookieStr;\n\t\t}\n\t}\n\n\tstatic getCookie(key: string, options?: ServerOptions): CookieValueTypes {\n\t\tconst _cookies = this.getCookies(options);\n\t\tconst value = _cookies[key];\n\n\t\tif (value === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this.processValue(this.decode(value));\n\t}\n\n\tstatic deleteCookie(key: string, options?: ServerOptions): void {\n\t\tthis.setCookie(key, \"\", { ...options, maxAge: -1 });\n\t}\n}\n","export const REMEMBER_ME_COOKIE_KEY = \"__rememberMe\";\n"],"mappings":"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","names":[]}